if roID != undefined then (closeRolloutFloater roID)
roID = NewRolloutFloater "Object ID" 200 123 1300 150

global ObjID
global geo = #()
global sha = #()
global objectsList = #()
global unde = #(), ID1 = #(), ID2 = #(), ID3 = #(), ID4 = #(), ID5 = #(), ID6 = #(), ID7 = #(), ID8 = #(), ID9 = #(), ID10 = #(), ID11 = #(), ID12 = #(), ID13 = #(), ID14 = #(), ID15 = #(), ID16 = #(), ID17 = #(), ID18 = #(), ID19 = #(), ID20 = #(), ID21 = #(), ID22 = #(), ID23 = #(), ID24 = #(), ID25 = #(), ID26 = #(), ID27 = #(), ID28 = #(), ID29 = #(), ID30 = #(), ID31 = #(), ID32 = #(), ID33 = #(), ID34 = #(), ID35 = #(), ID36 = #(), ID37 = #(), ID38 = #(), ID39 = #(), ID40 = #(), ID41 = #(), ID42 = #(), ID43 = #(), ID44 = #(), ID45 = #(), ID46 = #(), ID47 = #(), ID48 = #(), ID49 = #(), ID50 = #(), ID51 = #(), ID52 = #(), ID53 = #(), ID54 = #(), ID55 = #(), ID56 = #(), ID57 = #(), ID58 = #(), ID59 = #(), ID60 = #(), ID61 = #(), ID62 = #(), ID63 = #(), ID64 = #(), ID65 = #(), ID66 = #(), ID67 = #(), ID68 = #(), ID69 = #(), ID70 = #(), ID71 = #(), ID72 = #(), ID73 = #(), ID74 = #(), ID75 = #(), ID76 = #(), ID77 = #(), ID78 = #(), ID79 = #(), ID80 = #(), ID81 = #(), ID82 = #(), ID83 = #(), ID84 = #(), ID85 = #(), ID86 = #(), ID87 = #(), ID88 = #(), ID89 = #(), ID90 = #(), ID91 = #(), ID92 = #(), ID93 = #(), ID94 = #(), ID95 = #(), ID96 = #(), ID97 = #(), ID98 = #(), ID99 = #(), ID100 = #(), ID101 = #(), ID102 = #(), ID103 = #(), ID104 = #(), ID105 = #(), ID106 = #(), ID107 = #(), ID108 = #(), ID109 = #(), ID110 = #(), ID111 = #(), ID112 = #(), ID113 = #(), ID114 = #(), ID115 = #(), ID116 = #(), ID117 = #(), ID118 = #(), ID119 = #(), ID120 = #(), ID121 = #(), ID122 = #(), ID123 = #(), ID124 = #(), ID125 = #(), ID126 = #(), ID127 = #(), ID128 = #(), ID129 = #(), ID130 = #(), ID131 = #(), ID132 = #(), ID133 = #(), ID134 = #(), ID135 = #(), ID136 = #(), ID137 = #(), ID138 = #(), ID139 = #(), ID140 = #(), ID141 = #(), ID142 = #(), ID143 = #(), ID144 = #(), ID145 = #(), ID146 = #(), ID147 = #(), ID148 = #(), ID149 = #(), ID150 = #(), ID151 = #(), ID152 = #(), ID153 = #(), ID154 = #(), ID155 = #(), ID156 = #(), ID157 = #(), ID158 = #(), ID159 = #(), ID160 = #(), ID161 = #(), ID162 = #(), ID163 = #(), ID164 = #(), ID165 = #(), ID166 = #(), ID167 = #(), ID168 = #(), ID169 = #(), ID170 = #(), ID171 = #(), ID172 = #(), ID173 = #(), ID174 = #(), ID175 = #(), ID176 = #(), ID177 = #(), ID178 = #(), ID179 = #(), ID180 = #(), ID181 = #(), ID182 = #(), ID183 = #(), ID184 = #(), ID185 = #(), ID186 = #(), ID187 = #(), ID188 = #(), ID189 = #(), ID190 = #(), ID191 = #(), ID192 = #(), ID193 = #(), ID194 = #(), ID195 = #(), ID196 = #(), ID197 = #(), ID198 = #(), ID199 = #(), ID200 = #(), ID201 = #(), ID202 = #(), ID203 = #(), ID204 = #(), ID205 = #(), ID206 = #(), ID207 = #(), ID208 = #(), ID209 = #(), ID210 = #(), ID211 = #(), ID212 = #(), ID213 = #(), ID214 = #(), ID215 = #(), ID216 = #(), ID217 = #(), ID218 = #(), ID219 = #(), ID220 = #(), ID221 = #(), ID222 = #(), ID223 = #(), ID224 = #(), ID225 = #(), ID226 = #(), ID227 = #(), ID228 = #(), ID229 = #(), ID230 = #(), ID231 = #(), ID232 = #(), ID233 = #(), ID234 = #(), ID235 = #(), ID236 = #(), ID237 = #(), ID238 = #(), ID239 = #(), ID240 = #(), ID241 = #(), ID242 = #(), ID243 = #(), ID244 = #(), ID245 = #(), ID246 = #(), ID247 = #(), ID248 = #(), ID249 = #(), ID250 = #(), ID251 = #(), ID252 = #(), ID253 = #(), ID254 = #(), ID255 = #(), ID256 = #(), ID257 = #(), ID258 = #(), ID259 = #(), ID260 = #(), ID261 = #(), ID262 = #(), ID263 = #(), ID264 = #(), ID265 = #(), ID266 = #(), ID267 = #(), ID268 = #(), ID269 = #(), ID270 = #(), ID271 = #(), ID272 = #(), ID273 = #(), ID274 = #(), ID275 = #(), ID276 = #(), ID277 = #(), ID278 = #(), ID279 = #(), ID280 = #(), ID281 = #(), ID282 = #(), ID283 = #(), ID284 = #(), ID285 = #(), ID286 = #(), ID287 = #(), ID288 = #(), ID289 = #(), ID290 = #(), ID291 = #(), ID292 = #(), ID293 = #(), ID294 = #(), ID295 = #(), ID296 = #(), ID297 = #(), ID298 = #(), ID299 = #(), ID300 = #(), ID301 = #(), ID302 = #(), ID303 = #(), ID304 = #(), ID305 = #(), ID306 = #(), ID307 = #(), ID308 = #(), ID309 = #(), ID310 = #(), ID311 = #(), ID312 = #(), ID313 = #(), ID314 = #(), ID315 = #(), ID316 = #(), ID317 = #(), ID318 = #(), ID319 = #(), ID320 = #(), ID321 = #(), ID322 = #(), ID323 = #(), ID324 = #(), ID325 = #(), ID326 = #(), ID327 = #(), ID328 = #(), ID329 = #(), ID330 = #(), ID331 = #(), ID332 = #(), ID333 = #(), ID334 = #(), ID335 = #(), ID336 = #(), ID337 = #(), ID338 = #(), ID339 = #(), ID340 = #(), ID341 = #(), ID342 = #(), ID343 = #(), ID344 = #(), ID345 = #(), ID346 = #(), ID347 = #(), ID348 = #(), ID349 = #(), ID350 = #(), ID351 = #(), ID352 = #(), ID353 = #(), ID354 = #(), ID355 = #(), ID356 = #(), ID357 = #(), ID358 = #(), ID359 = #(), ID360 = #(), ID361 = #(), ID362 = #(), ID363 = #(), ID364 = #(), ID365 = #(), ID366 = #(), ID367 = #(), ID368 = #(), ID369 = #(), ID370 = #(), ID371 = #(), ID372 = #(), ID373 = #(), ID374 = #(), ID375 = #(), ID376 = #(), ID377 = #(), ID378 = #(), ID379 = #(), ID380 = #(), ID381 = #(), ID382 = #(), ID383 = #(), ID384 = #(), ID385 = #(), ID386 = #(), ID387 = #(), ID388 = #(), ID389 = #(), ID390 = #(), ID391 = #(), ID392 = #(), ID393 = #(), ID394 = #(), ID395 = #(), ID396 = #(), ID397 = #(), ID398 = #(), ID399 = #(), ID400 = #()

fn counting =
(
	objectsList = #()
	geo = #()
	for obj in geometry where classof obj != BoneGeometry do append geo obj
	sha = shapes as array
	objectsList = geo + sha
	
	global unde = #(), ID1 = #(), ID2 = #(), ID3 = #(), ID4 = #(), ID5 = #(), ID6 = #(), ID7 = #(), ID8 = #(), ID9 = #(), ID10 = #(), ID11 = #(), ID12 = #(), ID13 = #(), ID14 = #(), ID15 = #(), ID16 = #(), ID17 = #(), ID18 = #(), ID19 = #(), ID20 = #(), ID21 = #(), ID22 = #(), ID23 = #(), ID24 = #(), ID25 = #(), ID26 = #(), ID27 = #(), ID28 = #(), ID29 = #(), ID30 = #(), ID31 = #(), ID32 = #(), ID33 = #(), ID34 = #(), ID35 = #(), ID36 = #(), ID37 = #(), ID38 = #(), ID39 = #(), ID40 = #(), ID41 = #(), ID42 = #(), ID43 = #(), ID44 = #(), ID45 = #(), ID46 = #(), ID47 = #(), ID48 = #(), ID49 = #(), ID50 = #(), ID51 = #(), ID52 = #(), ID53 = #(), ID54 = #(), ID55 = #(), ID56 = #(), ID57 = #(), ID58 = #(), ID59 = #(), ID60 = #(), ID61 = #(), ID62 = #(), ID63 = #(), ID64 = #(), ID65 = #(), ID66 = #(), ID67 = #(), ID68 = #(), ID69 = #(), ID70 = #(), ID71 = #(), ID72 = #(), ID73 = #(), ID74 = #(), ID75 = #(), ID76 = #(), ID77 = #(), ID78 = #(), ID79 = #(), ID80 = #(), ID81 = #(), ID82 = #(), ID83 = #(), ID84 = #(), ID85 = #(), ID86 = #(), ID87 = #(), ID88 = #(), ID89 = #(), ID90 = #(), ID91 = #(), ID92 = #(), ID93 = #(), ID94 = #(), ID95 = #(), ID96 = #(), ID97 = #(), ID98 = #(), ID99 = #(), ID100 = #(), ID101 = #(), ID102 = #(), ID103 = #(), ID104 = #(), ID105 = #(), ID106 = #(), ID107 = #(), ID108 = #(), ID109 = #(), ID110 = #(), ID111 = #(), ID112 = #(), ID113 = #(), ID114 = #(), ID115 = #(), ID116 = #(), ID117 = #(), ID118 = #(), ID119 = #(), ID120 = #(), ID121 = #(), ID122 = #(), ID123 = #(), ID124 = #(), ID125 = #(), ID126 = #(), ID127 = #(), ID128 = #(), ID129 = #(), ID130 = #(), ID131 = #(), ID132 = #(), ID133 = #(), ID134 = #(), ID135 = #(), ID136 = #(), ID137 = #(), ID138 = #(), ID139 = #(), ID140 = #(), ID141 = #(), ID142 = #(), ID143 = #(), ID144 = #(), ID145 = #(), ID146 = #(), ID147 = #(), ID148 = #(), ID149 = #(), ID150 = #(), ID151 = #(), ID152 = #(), ID153 = #(), ID154 = #(), ID155 = #(), ID156 = #(), ID157 = #(), ID158 = #(), ID159 = #(), ID160 = #(), ID161 = #(), ID162 = #(), ID163 = #(), ID164 = #(), ID165 = #(), ID166 = #(), ID167 = #(), ID168 = #(), ID169 = #(), ID170 = #(), ID171 = #(), ID172 = #(), ID173 = #(), ID174 = #(), ID175 = #(), ID176 = #(), ID177 = #(), ID178 = #(), ID179 = #(), ID180 = #(), ID181 = #(), ID182 = #(), ID183 = #(), ID184 = #(), ID185 = #(), ID186 = #(), ID187 = #(), ID188 = #(), ID189 = #(), ID190 = #(), ID191 = #(), ID192 = #(), ID193 = #(), ID194 = #(), ID195 = #(), ID196 = #(), ID197 = #(), ID198 = #(), ID199 = #(), ID200 = #(), ID201 = #(), ID202 = #(), ID203 = #(), ID204 = #(), ID205 = #(), ID206 = #(), ID207 = #(), ID208 = #(), ID209 = #(), ID210 = #(), ID211 = #(), ID212 = #(), ID213 = #(), ID214 = #(), ID215 = #(), ID216 = #(), ID217 = #(), ID218 = #(), ID219 = #(), ID220 = #(), ID221 = #(), ID222 = #(), ID223 = #(), ID224 = #(), ID225 = #(), ID226 = #(), ID227 = #(), ID228 = #(), ID229 = #(), ID230 = #(), ID231 = #(), ID232 = #(), ID233 = #(), ID234 = #(), ID235 = #(), ID236 = #(), ID237 = #(), ID238 = #(), ID239 = #(), ID240 = #(), ID241 = #(), ID242 = #(), ID243 = #(), ID244 = #(), ID245 = #(), ID246 = #(), ID247 = #(), ID248 = #(), ID249 = #(), ID250 = #(), ID251 = #(), ID252 = #(), ID253 = #(), ID254 = #(), ID255 = #(), ID256 = #(), ID257 = #(), ID258 = #(), ID259 = #(), ID260 = #(), ID261 = #(), ID262 = #(), ID263 = #(), ID264 = #(), ID265 = #(), ID266 = #(), ID267 = #(), ID268 = #(), ID269 = #(), ID270 = #(), ID271 = #(), ID272 = #(), ID273 = #(), ID274 = #(), ID275 = #(), ID276 = #(), ID277 = #(), ID278 = #(), ID279 = #(), ID280 = #(), ID281 = #(), ID282 = #(), ID283 = #(), ID284 = #(), ID285 = #(), ID286 = #(), ID287 = #(), ID288 = #(), ID289 = #(), ID290 = #(), ID291 = #(), ID292 = #(), ID293 = #(), ID294 = #(), ID295 = #(), ID296 = #(), ID297 = #(), ID298 = #(), ID299 = #(), ID300 = #(), ID301 = #(), ID302 = #(), ID303 = #(), ID304 = #(), ID305 = #(), ID306 = #(), ID307 = #(), ID308 = #(), ID309 = #(), ID310 = #(), ID311 = #(), ID312 = #(), ID313 = #(), ID314 = #(), ID315 = #(), ID316 = #(), ID317 = #(), ID318 = #(), ID319 = #(), ID320 = #(), ID321 = #(), ID322 = #(), ID323 = #(), ID324 = #(), ID325 = #(), ID326 = #(), ID327 = #(), ID328 = #(), ID329 = #(), ID330 = #(), ID331 = #(), ID332 = #(), ID333 = #(), ID334 = #(), ID335 = #(), ID336 = #(), ID337 = #(), ID338 = #(), ID339 = #(), ID340 = #(), ID341 = #(), ID342 = #(), ID343 = #(), ID344 = #(), ID345 = #(), ID346 = #(), ID347 = #(), ID348 = #(), ID349 = #(), ID350 = #(), ID351 = #(), ID352 = #(), ID353 = #(), ID354 = #(), ID355 = #(), ID356 = #(), ID357 = #(), ID358 = #(), ID359 = #(), ID360 = #(), ID361 = #(), ID362 = #(), ID363 = #(), ID364 = #(), ID365 = #(), ID366 = #(), ID367 = #(), ID368 = #(), ID369 = #(), ID370 = #(), ID371 = #(), ID372 = #(), ID373 = #(), ID374 = #(), ID375 = #(), ID376 = #(), ID377 = #(), ID378 = #(), ID379 = #(), ID380 = #(), ID381 = #(), ID382 = #(), ID383 = #(), ID384 = #(), ID385 = #(), ID386 = #(), ID387 = #(), ID388 = #(), ID389 = #(), ID390 = #(), ID391 = #(), ID392 = #(), ID393 = #(), ID394 = #(), ID395 = #(), ID396 = #(), ID397 = #(), ID398 = #(), ID399 = #(), ID400 = #()

	
	for i = 1 to objectsList.count do
	(
		objBuf = objectsList[i].gbufferChannel
		if objBuf != 0 then
		(
			appendifunique (execute ("ID" + objBuf as string)) objectsList[i]
		)
		else
		(
			appendifunique unde objectsList[i]q
		)
	)
	
	ObjID.SelIDDDL.items = #()
	arr = #()
	if unde.count != 0 then
	(
		appendifunique arr ("Unassigned - (" + unde.count as string + ")")
	)
	
	i = 1
	while i < 400 do
	(
		val = execute ("ID" + i as string)
		if val.count != 0 then
		(
			appendifunique arr ("ID"  + i as string + " - (" + val.count as string + ")")
			i += 1
		)
		else
		(
			i += 1
		)
	)
	
	ObjID.SelIDDDL.items = arr
)

fn assigning id =
(
	for i in selection do
	(
		i.gbufferChannel = id
	)
	counting()
)

fn refresh =
(
	counting()
	temp = #()
	
	if selection as array != #() then
	(
		for i in selection do
		(
			try(appendifunique temp i.gbufferChannel)catch()
		)
		if temp.count == 1 then
		(
			ObjID.setIDSpn.indeterminate = true
			ObjID.setIDSpn.value = temp[1]
		)
		else
		(
			ObjID.setIDSpn.indeterminate = true
		)
	)
)

fn closing =
(
	callbacks.removeScripts id:#ObjID
)


----------------------------------------------------
-----------ROLLOUTS----------------------------
-----------------------------------------------------

rollout ObjID "Tools" rolledup:false
(
	spinner setIDSpn "Set ID :" range:[0,400,0] type:#integer
	dropdownlist SelIDDDL "Select :" type:#integer
	checkbox ClearChk "Clear Selection" checked:true
	
	on ObjID open do refresh()
	on ObjID close do closing()
	
	on setIDSpn changed state do
	(
		assigning(state)
	)
	
	on SelIDDDL selected theSel do
	(
		case (matchpattern SelIDDDL.selected pattern:"Unassigned*") of
		(
			false:
			(
				tp = filterstring SelIDDDL.selected "D"
				index = filterstring tp[2] " "
				
				if ClearChk.checked == false then
				(
					selectmore (for obj in objectsList where (obj.gbufferChannel == index[1] as integer) and (classof obj != BoneGeometry) collect obj)
				)
				else
				(
					clearselection()
					selectmore (for obj in objectsList where (obj.gbufferChannel == index[1] as integer) and (classof obj != BoneGeometry) collect obj)
				)
			)
			true:
			(
				if ClearChk.checked == false then
				(
					selectmore (for obj in objectsList where (obj.gbufferChannel == 0) and (classof obj != BoneGeometry) collect obj)
				)
				else
				(
					clearselection()
					selectmore (for obj in objectsList where (obj.gbufferChannel == 0) and (classof obj != BoneGeometry) collect obj)
				)
			)
		)
	)
)

addRollout ObjID roID


callbacks.addScript #selectionSetChanged "refresh()" id:#ObjID

callbacks.addScript #nodeCreated "counting()" id:#ObjID
callbacks.addScript #nodeCloned "counting()" id:#ObjID
callbacks.addScript #sceneNodeAdded "counting()" id:#ObjID





