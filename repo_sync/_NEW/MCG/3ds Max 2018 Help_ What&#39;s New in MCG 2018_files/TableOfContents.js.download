// Copyright 2020 Autodesk, Inc. All rights reserved.
UIComponent.define("TableOfContents",{require:{scripts:[],styles:["TableOfContents"],template:["TableOfContentsPanel","_tableOfContentsDefault","_tableOfContentsResourceError","_tableOfContents","_tocNodeLink"]},i18n:{ERROR_LOADING_RESOURCE:"Could not load resource"},methods:{init:function(){var e=this;return this.element.addClass("sidebar-panel-container"),this.element.on("click",".ui-sidebar-toggle",function(e){$(this).closest(".ui-sidebar").toggleClass("panel-open")}),this.element.on("click","li.node > a[href]",function(t){if(t.preventDefault(),this.href){var n=$(this),i=(n.attr("data-url")||n.attr("href")||"").trim(),r=t.currentTarget.href||i,o=n.closest(".node"),a=this.getAttribute("data-type");e.deselect(),o.attr("aria-selected","true"),"caas"===a?e.trigger("requestRoute","caas",{caasKey:o.attr("data-id")}):"guid"===a&&e.trigger("requestRoute","guid",{guid:o.attr("data-id").split("::")[0],url:i,hash:n.attr("data-anchor")});var d=$.map(o.parents(".node").addBack(),function(e){return e.querySelector("a").textContent}).join(": ");Boot.App.trigger("logGAEvent",{event:"navigation",parentTopics:d,destinationPage:r,destinationTitle:t.target.textContent,plc:Boot.Config.meta.product,releaseYear:Boot.Config.meta.release,language:Boot.Config.meta.language}),Boot.App.trigger("logADPEvent","toc_click",r)}}),this.element.on("click",'li.node > [role="button"]',function(t){var n=$(this).closest("li.node");e.toggleNode(n),n.is('[aria-expanded="true"]')&&n.children("ul").focus()}),this.element.on("keydown",'li.node > [role="button"]',function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),e.stopPropagation(),$(e.target).trigger("click"))}),this.element.on("keydown","li.node",function(t){var n=$(t.target).closest("li.node");37===t.keyCode&&n.is('[aria-expanded="true"]')||39===t.keyCode&&n.is('[aria-expanded="false"]')?(t.stopPropagation(),t.preventDefault(),e.toggleNode(n)):39===t.keyCode&&n.is('[aria-expanded="true"]')?n.children("ul").children("li.node:first-child").children("a").focus():37!==t.keyCode||!n.is('[aria-expanded="false"]')&&n.is("[aria-expanded]")||n.parent().closest("li.node").children("a").focus()}),this.element.on("click",".toc-switch-view",function(){e.switchToDefault()}),$.ajax({url:Boot.Config.tocPath,dataType:"json",contentType:"application/json; charset=UTF-8"}).then(function(e){return e.children?e:e.books?1===e.books.length?{children:e.books[0].children}:{children:e.books}:$.Deferred().reject()}).then(function(t){return t.children&&(Boot.Config.expandToC&&t.children[0].children&&(t.children[0].opn=!0),e.setIds(t.children)),t}).then(function(t){Boot.App.model.on("change:article",function(){e.element.closest(".ui-sidebar").removeClass("panel-open")}),e.setData(t)}).fail(function(){e.setData({children:[],text:e.i18n.ERROR_LOADING_RESOURCE},!0)})},setIds:function(){var e=0,t=/([^\/]+?)\.html?(?:#(.*))?$/;return function n(i){(i||[]).forEach(function(i){if(i.id||(i.id=i.caaskey||"toc_"+ ++e),i.ln){var r=i.ln.trim().match(t);r&&(Boot.Config.inferSEOUrls&&(i.guid=r[1]),r[2]&&(i.anchor=r[2],i.id=i.id+"::"+i.anchor))}i.children&&n(i.children)},this)}}(),getCurrentTree:function(){return this.model.get("focusedSubTree")&&this.model.get("focusedSubTree").children||this.model.get("children")||{}},getSubTree:function(e,t,n){for(var i=0;i<e.length;i++)if(e[i].id===t[0])return t.length>1?this.getSubTree(e[i].children,t.slice(1),n):n?e[i]:e[i].children},renderSubTree:function(e,t){t||(t=$.map(e.parents(".node").addBack(),function(e){return e.getAttribute("data-id")}));var n=this.getSubTree(this.getCurrentTree(),t);e.append(this.resources.partials._tableOfContents({children:n}))},isNodeInTree:function(e,t){t=t||this.getCurrentTree();for(var n=0;n<t.length;n++)if(t[n].id===e||t[n].children&&this.isNodeInTree(e,t[n].children))return!0;return!1},searchNodePath:function(e,t){var n;t=t||this.getCurrentTree();for(var i=0;i<t.length;i++){if(t[i].id===e)return[{id:t[i].id,guid:t[i].guid,caaskey:t[i].caaskey,ln:t[i].ln,ttl:t[i].ttl}];if(t[i].children&&(n=this.searchNodePath(e,t[i].children)))return n.unshift({id:t[i].id,guid:t[i].guid,caaskey:t[i].caaskey,ln:t[i].ln,ttl:t[i].ttl}),n}},toggleNode:function(e){e.is('[aria-expanded="true"]')?e.attr("aria-expanded","false"):(e.children(".node-tree").length||this.renderSubTree(e),e.attr("aria-expanded","true")),this.trigger("expandCollapse")},expandToNode:function(e){var t=this.searchNodePath(e),n=this.element.find(".node-tree-container"),i;if(t){if(!this.isSelectedNode(e)){for(var r=0;r<t.length;r++)i=n.find('.node[data-id="'+t[r].id+'"]'),i.is("[aria-expanded]")&&(i.attr("aria-expanded","true"),i.children(".node-tree").length||this.renderSubTree(i,t.slice(0,r+1).map(function(e){return e.id})));this.deselect(),i.attr("aria-selected","true"),setTimeout($.proxy(function(){this.scrollToNode(i.children("a"))},this),0)}return this.trigger("nodeSelected",t),this.trigger("expandCollapse"),i}},scrollToNode:function(e){var t=this.element.find(".ui-contents-panel"),n=this.element.height(),i=t.scrollTop(),r=e.offset().top-this.element.offset().top+i,o=e.outerHeight(!0);r<i?t.scrollTop(r-parseInt(e.parent().css("paddingTop"),10)):r+o>n+i&&t.scrollTop(r+o-n+parseInt(e.parent().css("paddingBottom"),10))},getSelectedNode:function(){return this.element.find(".node-tree-container").find('.node[aria-selected="true"]')},isSelectedNode:function(e){return this.getSelectedNode().attr("data-id")===e},deselect:function(){this.getSelectedNode().attr("aria-selected","false")},expandAll:function(e){var t=this;e=e||this.element.find(".node-tree-container"),e.find('li.node[aria-expanded="false"]').each(function(){var e=$(this);e.children(".node-tree").length||t.renderSubTree(e),e.attr("aria-expanded","true"),t.expandAll.call(t,e.children(".node-tree"))})},collapseAll:function(){this.element.find('li.node[aria-expanded="true"]').attr("aria-expanded","false")},switchToDefault:function(){return this.model.set("focusedSubTree",void 0),this.render()},render:function(){this.model.get("focusedSubTree")?this.parent({text:this.model.get("text"),toc:this.model.get("focusedSubTree")}):this.parent({text:this.model.get("text"),toc:{children:this.model.get("children"),isRootNode:!0}})}}});
// TableOfContentsPanel.handlebars, _tableOfContentsDefault.handlebars, _tableOfContentsResourceError.handlebars, _tableOfContents.handlebars, _tocNodeLink.handlebars
!function(){var n=Handlebars.template,r=Handlebars.templates=Handlebars.templates||{};r.TableOfContentsPanel=n(function(n,r,a,e,t){function o(n,r){var t;return t=p.invokePartial(e._tableOfContentsResourceError,"_tableOfContentsResourceError",n,a,e,r),t||0===t?t:""}function i(n,r){var e;return e=a["if"].call(n,n&&n.toc,{hash:{},inverse:p.noop,fn:p.program(4,l,r),data:r}),e||0===e?e:""}function l(n,r){var t;return t=p.invokePartial(e._tableOfContentsDefault,"_tableOfContentsDefault",n,a,e,r),t||0===t?t:""}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),e=this.merge(e,n.partials),t=t||{};var s,f="",p=this;return f+='<div class="ui-contents-panel ui-tab-panel">',s=a["if"].call(r,r&&r.text,{hash:{},inverse:p.program(3,i,t),fn:p.program(1,o,t),data:t}),(s||0===s)&&(f+=s),f+="</div>\n"}),r._tableOfContentsDefault=n(function(n,r,a,e,t){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),e=this.merge(e,n.partials),t=t||{};var o,i="",l=this;return i+='<button class="ui-sidebar-toggle ui-smallscreen" aria-label="Toggle sidebar" tabindex="-1"></button>\r\n<div class="node-tree-overflow">\r\n    <div class="node-tree-container" role="navigation">',o=l.invokePartial(e._tableOfContents,"_tableOfContents",r&&r.toc,a,e,t),(o||0===o)&&(i+=o),i+="</div>\r\n</div>"}),r._tableOfContentsResourceError=n(function(n,r,a,e,t){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),t=t||{};var o,i="function";return o=r&&r.text,o=typeof o===i?o.apply(r):o,o||0===o?o:""}),r._tableOfContents=n(function(n,r,a,e,t){function o(n,r){var e,t="";return t+='\r\n<ul class="node-tree" role="',e=a["if"].call(n,n&&n.isRootNode,{hash:{},inverse:g.program(4,l,r),fn:g.program(2,i,r),data:r}),(e||0===e)&&(t+=e),t+='" tabindex="-1">\r\n    ',e=a.each.call(n,n&&n.children,{hash:{},inverse:g.noop,fn:g.program(6,s,r),data:r}),(e||0===e)&&(t+=e),t+="\r\n</ul>\r\n"}function i(){return"tree"}function l(){return"group"}function s(n,r){var t,o="";return o+='\r\n    <li class="node" ',t=a["if"].call(n,n&&n.children,{hash:{},inverse:g.noop,fn:g.program(7,f,r),data:r}),(t||0===t)&&(o+=t),o+=' data-id="'+b((t=n&&n.id,typeof t===m?t.apply(n):t))+'" role="treeitem">\r\n        ',t=a["if"].call(n,n&&n.children,{hash:{},inverse:g.noop,fn:g.program(12,u,r),data:r}),(t||0===t)&&(o+=t),t=g.invokePartial(e._tocNodeLink,"_tocNodeLink",n,a,e,r),(t||0===t)&&(o+=t),t=a["if"].call(n,n&&n.opn,{hash:{},inverse:g.noop,fn:g.program(14,h,r),data:r}),(t||0===t)&&(o+=t),o+="\r\n    </li>\r\n    "}function f(n,r){var e,t="";return t+='aria-expanded="',e=a["if"].call(n,n&&n.opn,{hash:{},inverse:g.program(10,c,r),fn:g.program(8,p,r),data:r}),(e||0===e)&&(t+=e),t+='"'}function p(){return"true"}function c(){return"false"}function u(){return'<span class="expand-collapse" role="button"></span>'}function h(n,r){var t;return t=g.invokePartial(e._tableOfContents,"_tableOfContents",n,a,e,r),t||0===t?t:""}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),e=this.merge(e,n.partials),t=t||{};var d,v="",g=this,m="function",b=this.escapeExpression;return d=a["if"].call(r,r&&r.children,{hash:{},inverse:g.noop,fn:g.program(1,o,t),data:t}),(d||0===d)&&(v+=d),v+="\r\n"}),r._tocNodeLink=n(function(n,r,a,e,t){function o(n){var r,a="";return a+='\r\n<a href="?caas='+g((r=n&&n.caaskey,typeof r===v?r.apply(n):r))+'" data-type="caas">'+g((r=n&&n.ttl,typeof r===v?r.apply(n):r))+"</a>\r\n"}function i(n,r){var e,t="";return t+="\r\n<a ",e=a["if"].call(n,n&&n.ln,{hash:{},inverse:m.program(13,u,r),fn:m.program(4,l,r),data:r}),(e||0===e)&&(t+=e),t+=">"+g((e=n&&n.ttl,typeof e===v?e.apply(n):e))+"</a>\r\n"}function l(n,r){var e,t="";return t+='href="',e=a["if"].call(n,n&&n.guid,{hash:{},inverse:m.program(7,f,r),fn:m.program(5,s,r),data:r}),(e||0===e)&&(t+=e),e=a["if"].call(n,n&&n.anchor,{hash:{},inverse:m.noop,fn:m.program(9,p,r),data:r}),(e||0===e)&&(t+=e),t+='" data-url="'+g((e=n&&n.ln,typeof e===v?e.apply(n):e))+'" data-type="guid"',e=a["if"].call(n,n&&n.anchor,{hash:{},inverse:m.noop,fn:m.program(11,c,r),data:r}),(e||0===e)&&(t+=e),t}function s(n){var r,a="";return a+="?guid="+g((r=n&&n.guid,typeof r===v?r.apply(n):r))}function f(n){var r;return g((r=n&&n.ln,typeof r===v?r.apply(n):r))}function p(n){var r,a="";return a+="#"+g((r=n&&n.anchor,typeof r===v?r.apply(n):r))}function c(n){var r,a="";return a+=' data-anchor="'+g((r=n&&n.anchor,typeof r===v?r.apply(n):r))+'"'}function u(){return'role="button" tabindex="0"'}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,n.helpers),t=t||{};var h,d="",v="function",g=this.escapeExpression,m=this;return h=a["if"].call(r,r&&r.caaskey,{hash:{},inverse:m.program(3,i,t),fn:m.program(1,o,t),data:t}),(h||0===h)&&(d+=h),d+="\r\n"})}();
